<!-- Mahnoors Code -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dormify - Product Details</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<header class="p-3 bg-dark text-white text-center">
    <h1 id="product-name">Product Name</h1>
</header>

<div class="container my-5">
    <div class="row">
        <div class="col-md-6">
            <img id="product-image" src="#" class="img-fluid" alt="Product Image">
        </div>
        <div class="col-md-6">
            <p id="product-description">Product description goes here.</p>
            <p id="product-price">Price: $0</p>
            <button class="btn btn-primary" onclick="addToCart()">Add to Cart</button>
        </div>
    </div>
</div>

<footer class="bg-dark text-white text-center p-3">
    &copy; 2024 Dormify. All rights reserved.
</footer>

<script>
// Function to get URL parameters
function getUrlParameter(name) {
    var url = window.location.search;
    var regex = new RegExp('[?&]' + name + '=([^&#]*)', 'i');
    var results = regex.exec(url);
    return results ? decodeURIComponent(results[1]) : null;
}

// Fetch the product details from the API
function fetchProductDetails(productName) {
    fetch(`http://localhost:5000/api/products/${productName}`)  // Adjust API endpoint as needed
        .then(response => response.json())
        .then(product => {
            if (product) {
                document.getElementById('product-name').innerText = product.name;
                document.getElementById('product-image').src = `http://localhost:5000/images/${product.image}`;  // Ensure correct image path
                document.getElementById('product-image').alt = product.name;
                document.getElementById('product-description').innerText = product.description;
                document.getElementById('product-price').innerText = `Price: ${product.price}`;
                
                // Store the product details for later use in "Add to Cart"
                window.currentProduct = product;
            } else {
                document.getElementById('product-name').innerText = 'Product Not Found';
                document.getElementById('product-description').innerText = 'Sorry, we couldn\'t find the product you were looking for.';
            }
        })
        .catch(error => {
            console.error('Error fetching product details:', error);
            document.getElementById('product-name').innerText = 'Product Not Found';
            document.getElementById('product-description').innerText = 'Error fetching product details.';
        });
}

// Get product name from the URL
const productName = getUrlParameter('product');

// Fetch and display the product details
if (productName) {
    fetchProductDetails(productName);
} else {
    document.getElementById('product-name').innerText = 'Product Not Found';
    document.getElementById('product-description').innerText = 'No product specified.';
}

// Function to add product to cart and redirect to cart page
function addToCart() {
    if (!window.currentProduct) {
        alert('No product found');
        return;
    }

    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    // Check if the product already exists in the cart
    let existingProduct = cart.find(item => item.name === window.currentProduct.name);
    if (existingProduct) {
        existingProduct.quantity += 1;
    } else {
        // Add new product to the cart
        cart.push({...window.currentProduct, quantity: 1});
    }

    // Save the updated cart back to localStorage
    localStorage.setItem('cart', JSON.stringify(cart));

    // Redirect to the cart page
    window.location.href = "cart.html";  // Redirect to the cart page after adding the item
}
</script>

</body>
</html>
